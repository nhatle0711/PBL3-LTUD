<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<div th:replace="fragments/seller_head.html :: sellerhead"></div>
<body>

<div th:replace="fragments/seller_header.html :: sellerheader"></div>

<div class="product_manager_contain">
    <div th:if="${deleteSuccess}" class="popup success show" id="popup-success">
        <i class="fa-solid fa-circle-check popup-icon"></i>
        <h3>Xo√° s·∫£n ph·∫©m th√†nh c√¥ng! üéâ</h3>
        <button onclick="closePopup()">ƒê√≥ng</button>
    </div>
    <div th:if="${deleteFail}" class="popup error show" id="popup-error">
        <i class="fa-solid fa-circle-xmark popup-icon"></i>
        <h3> ‚ö†Ô∏è Kh√¥ng th·ªÉ xo√° s·∫£n ph·∫©m v√¨ ƒë√£ c√≥ ƒë∆°n h√†ng li√™n quan.</h3>
        <p>*G·ª£i √Ω: chuy·ªÉn s·ªë l∆∞·ª£ng v·ªÅ 0</p>
        <button onclick="closePopup()">ƒê√≥ng</button>
    </div>
     <div th:if="${deleteSuccess != null or deleteFail != null}" class="overlay" id="popup-overlay" onclick="closePopup()"></div>

    <div th:replace="fragments/sidebar_seller.html :: sidebarseller"></div>

    <div class="all-product">
        <div class="all-product-header">
            <div class="all-product-title">S·∫£n ph·∫©m</div>
            <div class="add-product"><a th:href="@{/seller/addproduct}"><span>+</span> Th√™m s·∫£n ph·∫©m m·ªõi</a></div>
        </div>
        <div class="all-product-list">
        <a class="all-product-item" th:classappend="${statusFilter == null} ? ' item-active'"
             th:href="@{/seller/product-manager(page=1, keyword=${keyword})}">T·∫•t c·∫£</a>

        <a class="all-product-item" th:classappend="${statusFilter == 1} ? ' item-active'"
             th:href="@{/seller/product-manager(page=1, keyword=${keyword}, status=1)}">
            ƒêang ho·∫°t ƒë·ªông(<span th:text="${activeCount}"></span>)
        </a>

        <a class="all-product-item" th:classappend="${statusFilter == 2} ? ' item-active'"
             th:href="@{/seller/product-manager(page=1, keyword=${keyword}, status=2)}">
            Vi ph·∫°m(<span th:text="${violateCount}"></span>)
        </a>

        <a class="all-product-item" th:classappend="${statusFilter == 0} ? ' item-active'"
             th:href="@{/seller/product-manager(page=1, keyword=${keyword}, status=0)}">
            ƒêang ch·ªù duy·ªát(<span th:text="${pendingCount}"></span>)
        </a>
            </div>
            <div class="all-product-list">
        <div th:if="${message}" class="alert alert-info" th:text="${message}"></div>
        <div id="all-product" class="all-product-conttent section active">

                    <form th:action="@{/seller/product-manager}" method="get">
                        <div class="all-product-search">
                        <div class="category-search">
                        <input type="text" class="category-search-input" name="keyword"
                               th:value="${keyword}" placeholder="T√¨m t√™n s·∫£n ph·∫©m">
                        <input type="hidden" name="status" th:value="${statusFilter}">
                        </div>
                        <button type="submit" class="btn-product-search">T√¨m</button>
                        </div>
                    </form>

            <table class="table-product">
                <thead>
                <tr>
                    <th class="col_product">S·∫£n ph·∫©m</th>
                    <th class="col_revenue">Doanh thu</th>
                    <th class="col_price">Gi√°</th>
                    <th class="col_stock">Kho h√†ng</th>
                    <th class="col_category">Danh m·ª•c</th>
                    <th class="col_status">T√¨nh tr·∫°ng</th>
                    <th class="col_button">Ch·ª©c nƒÉng</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="pro : ${listproshop}">
                    <td class="col_product_value">
                        <img th:src="@{/img/{fileimg}(fileimg=${pro.imageurl})}" alt="" class="col_product_img">
                        <div class="col_product_name" th:text="${pro.name}"></div>
                    </td>
                    <td class="col_revenue_value" th:text="${#numbers.formatInteger(pro.revenue, 1, 'POINT')}"></td>
                    <td class="col_price_value" th:text="${#numbers.formatInteger(pro.price, 1, 'POINT')}"></td>
                    <td class="col_stock_value" th:text="${pro.stock}"></td>
                    <td class="col_category_value" th:text="${pro.category.name}"></td>
                    <td class="col_status_value" th:switch="${pro.status}">
                        <span th:case="0">ƒêang ch·ªù duy·ªát</span>
                        <span th:case="1">ƒêang ho·∫°t ƒë·ªông</span>
                        <span th:case="2">Vi ph·∫°m</span>
                    </td>
                    <td class="col_button_value" >
                        <a class="btn btn--primary" th:href="@{/seller/editproduct/{id}(id=${pro.id})}">S·ª≠a</a>
                        <a class="btn btn-delete" th:href="@{/seller/deleteproduct/{id}(id=${pro.id})}"
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° s·∫£n ph·∫©m n√†y kh√¥ng?')">X√≥a</a>
                    </td>
                    <!--                    <td>-->
                    <!--                        <button class="btn btn-edit"><a th:href="@{/seller/product/edit/{id}(id=${pro.id})}" style="color:white">S·ª≠a</a></button>-->
                    <!--                        <form th:action="@{/seller/product/delete/{id}(id=${pro.id})}" method="post" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a danh m·ª•c n√†y?')">-->
                    <!--                            <button type="submit" class="btn btn-delete" >X√≥a</button>-->
                    <!--                        </form>-->
                    <!--                    </td>-->
                </tr>
                </tbody>
            </table>
            <ul class="custom-pagination">
                <!-- Previous -->
                <li class="custom-pagination__item" th:if="${currentPage > 1}">
                    <a class="custom-pagination__link"
                       th:href="@{'/seller/product-manager'(keyword=${keyword}, status=${statusFilter}, page=${currentPage - 1})}">
                        <i class="custom-pagination__icon bx bxs-chevron-left"></i>
                    </a>
                </li>

                <!-- Page Numbers -->
                <li class="custom-pagination__item"
                    th:each="i : ${#numbers.sequence(1, totalPages)}"
                    th:classappend="${currentPage == i} ? 'custom-pagination__item--active'">
                    <a class="custom-pagination__link"
                       th:href="@{'/seller/product-manager'(keyword=${keyword}, status=${statusFilter}, page=${i})}"
                       th:text="${i}">
                    </a>
                </li>

                <!-- Next -->
                <li class="custom-pagination__item" th:if="${currentPage < totalPages}">
                    <a class="custom-pagination__link"
                       th:href="@{'/seller/product-manager'(keyword=${keyword}, status=${statusFilter}, page=${currentPage + 1})}">
                        <i class="custom-pagination__icon bx bxs-chevron-right"></i>
                    </a>
                </li>
            </ul>

        </div>
    </div>
</div>

<!--      -->
<script>
    window.onload = function () {
      const popup = document.getElementById("popup-error");
      const overlay = document.getElementById("popup-overlay");
      if (popup && overlay) {
          popup.style.display = "block";
          overlay.style.display = "block";
      }
  }

  function closePopup() {
      const popup = document.getElementById("popup-error");
      const pop = document.getElementById("popup-success");
      const overlay = document.getElementById("popup-overlay");

      if (popup) popup.style.display = "none";
      if (pop) pop.style.display = "none";
      if (overlay) overlay.style.display = "none";
  }
</script>
<script th:src="@{/js/seller_script.js}"></script>
</body>
</html>